<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links" id="navigation-links">
          <!-- ÂØºËà™ÈìæÊé•Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
        </ul>
        <ul class="hidden-links hidden" id="mobile-navigation-links">
          <!-- ÁßªÂä®Á´ØÂØºËà™ÈìæÊé•Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
          <li class="language-switcher">
            <button id="lang-toggle" class="lang-toggle-btn" title="ÂàáÊç¢ËØ≠Ë®Ä/Switch Language">
              <span class="lang-text-mobile" data-show-when="zh">English</span>
              <span class="lang-text-mobile" data-show-when="en">‰∏≠Êñá</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>
    <!-- Ê°åÈù¢Á´ØÁã¨Á´ãÁöÑËØ≠Ë®ÄÂàáÊç¢Âô® -->
    <div class="language-switcher language-switcher--desktop">
      <button id="lang-toggle-desktop" class="lang-toggle-btn" title="ÂàáÊç¢ËØ≠Ë®Ä/Switch Language">
        üåê
      </button>
    </div>
  </div>
</div>

<script>
// ÂØºËà™Êï∞ÊçÆ
const navigationData = {
  zh: [
    { title: "‰∏ªÈ°µ", section: "about-me" },
    { title: "ÊïôËÇ≤ÁªèÂéÜ", section: "educations" },
    { title: "Â≠¶ÊúØËÆ∫Êñá", section: "publications" },
    { title: "È°πÁõÆÁªèÂéÜ", section: "projects" },
    { title: "‰∏ìÂà©", section: "patents" },
    { title: "Â≠¶ÊúØÊúçÂä°", section: "services" },
    { title: "Ëé∑Â•ñÊÉÖÂÜµ", section: "awards" }
  ],
  en: [
    { title: "Homepage", section: "about-me" },
    { title: "Education", section: "educations" },
    { title: "Publications", section: "publications" },
    { title: "Projects", section: "projects" },
    { title: "Patents", section: "patents" },
    { title: "Services", section: "services" },
    { title: "Awards", section: "awards" }
  ]
};

// Ëé∑ÂèñÂΩìÂâçËØ≠Ë®Ä
function getCurrentLanguage() {
  const currentPath = window.location.pathname;
  return (currentPath.includes('/en/')) ? 'en' : 'zh';
}

// ÁîüÊàêÂØºËà™ÈìæÊé•
function generateNavigationLinks() {
  const currentLang = getCurrentLanguage();
  const navData = navigationData[currentLang];
  const navContainer = document.getElementById('navigation-links');
  const mobileNavContainer = document.getElementById('mobile-navigation-links');
  
  if (!navContainer || !navData) return;
  
  // Ê∏ÖÁ©∫Áé∞ÊúâÈìæÊé•
  navContainer.innerHTML = '';
  
  // ÁîüÊàêÊ°åÈù¢Á´ØÂØºËà™ÈìæÊé•
  navData.forEach((item, index) => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    
    // ËÆæÁΩÆÈìæÊé•Â±ûÊÄß - ‰ΩøÁî®Áõ∏ÂØπÈîöÁÇπÈìæÊé•
    a.href = `#${item.section}`;
    a.textContent = item.title;
    a.className = 'nav-link';
    a.dataset.section = item.section;
    
    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜÈîöÁÇπË∑≥ËΩ¨
    a.addEventListener('click', function(e) {
      e.preventDefault();
      
      console.log('=== Navigation Click Debug ===');
      console.log('Current URL:', window.location.href);
      console.log('Current pathname:', window.location.pathname);
      console.log('Clicking on:', item.title, 'section:', item.section);
      
      // Â∞ùËØïÂ§öÁßçÊñπÂºèÊü•ÊâæÁõÆÊ†áÂÖÉÁ¥†
      let targetSection = document.getElementById(item.section);
      
      // Â¶ÇÊûúÁõ¥Êé•Êü•ÊâæÂ§±Ë¥•ÔºåÂ∞ùËØïÂÖ∂‰ªñÊñπÊ≥ï
      if (!targetSection) {
        console.log('Direct ID lookup failed, trying alternative methods...');
        
        // ÊñπÊ≥ï1ÔºöÊü•ÊâæÂåÖÂê´ÁâπÂÆöÊñáÊú¨ÁöÑÊ†áÈ¢òÂÖÉÁ¥†
        const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
        console.log('Found headings:', headings.length);
        
        for (let heading of headings) {
          console.log('Checking heading:', heading.textContent.trim(), 'ID:', heading.id);
          if (heading.textContent.includes(item.title) || heading.id === item.section) {
            targetSection = heading;
            console.log('Found target heading:', heading);
            break;
          }
        }
        
        // ÊñπÊ≥ï2ÔºöÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
        if (!targetSection) {
          console.log('Heading search failed, trying anchor search...');
          const allAnchors = document.querySelectorAll('[id]');
          console.log('All elements with ID:', allAnchors.length);
          
          for (let anchor of allAnchors) {
            console.log('Anchor ID:', anchor.id, 'Tag:', anchor.tagName, 'Text:', anchor.textContent.substring(0, 50));
            if (anchor.id === item.section || anchor.id.includes(item.section)) {
              targetSection = anchor;
              console.log('Found target anchor:', anchor);
              break;
            }
          }
        }
        
        // ÊñπÊ≥ï3ÔºöÊü•ÊâæÂåÖÂê´sectionÂêçÁß∞ÁöÑspanÊàñÂÖ∂‰ªñÂÖÉÁ¥†
        if (!targetSection) {
          console.log('Anchor search failed, trying span search...');
          const spans = document.querySelectorAll('span[id]');
          for (let span of spans) {
            if (span.id === item.section) {
              targetSection = span;
              console.log('Found target span:', span);
              break;
            }
          }
        }
      }
      
      console.log('Final target element found:', targetSection);
      
      if (targetSection) {
        // Á°Æ‰øùÂÖÉÁ¥†ÂèØËßÅ
        targetSection.style.scrollMarginTop = '100px'; // ‰∏∫Âõ∫ÂÆöÂØºËà™Ê†èÁïôÂá∫Á©∫Èó¥
        targetSection.scrollIntoView({ behavior: 'smooth' });
        console.log('Successfully scrolled to section:', item.section);
      } else {
        console.log('All search methods failed for section:', item.section);
        // Â∞ùËØïÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
        const allAnchors = document.querySelectorAll('[id]');
        console.log('All available anchors:', Array.from(allAnchors).map(el => ({id: el.id, tag: el.tagName, text: el.textContent.substring(0, 30)})));
        
        // Â¶ÇÊûúËøòÊòØÊâæ‰∏çÂà∞ÔºåÂ∞ùËØï‰ΩøÁî®ÊµèËßàÂô®ÈªòËÆ§ÁöÑÈîöÁÇπË∑≥ËΩ¨
        console.log('Falling back to default anchor behavior');
        window.location.hash = item.section;
      }
      
      console.log('=== End Debug ===');
    });
    
    // Á¨¨‰∏Ä‰∏™ÈìæÊé•ÊòØ‰∏ªÈ°µÔºåÈúÄË¶ÅÁâπÊÆäÊ†∑Âºè
    if (index === 0) {
      li.className = 'masthead__menu-item masthead__menu-item--lg masthead__menu-home-item';
    } else {
      li.className = 'masthead__menu-item';
    }
    
    li.appendChild(a);
    navContainer.appendChild(li);
  });

  // ÁîüÊàêÁßªÂä®Á´ØÂØºËà™ÈìæÊé•
  if (mobileNavContainer) {
    // Êü•ÊâæÁé∞ÊúâÁöÑÂØºËà™ÈìæÊé•ÔºåÂ¶ÇÊûúÂ≠òÂú®ÂàôÊõ¥Êñ∞ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÂàôÂàõÂª∫
    const existingNavItems = mobileNavContainer.querySelectorAll('li:not(.language-switcher)');
    
    // Â¶ÇÊûúÂ∑≤ÁªèÊúâÂØºËà™È°πÔºåÂàôÊõ¥Êñ∞ÂÆÉ‰ª¨
    if (existingNavItems.length > 0) {
      existingNavItems.forEach((li, index) => {
        if (index < navData.length) {
          const a = li.querySelector('a');
          if (a) {
            a.textContent = navData[index].title;
            a.href = `#${navData[index].section}`;
            a.dataset.section = navData[index].section;
            
            // ÁßªÈô§ÊóßÁöÑÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨Âô®
            a.replaceWith(a.cloneNode(true));
            const newA = li.querySelector('a');
            
            // Ê∑ªÂä†Êñ∞ÁöÑÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜÈîöÁÇπË∑≥ËΩ¨
            newA.addEventListener('click', function(e) {
              e.preventDefault();
              
              console.log('=== Mobile Navigation Click Debug ===');
              console.log('Current URL:', window.location.href);
              console.log('Current pathname:', window.location.pathname);
              console.log('Mobile: Clicking on:', navData[index].title, 'section:', navData[index].section);
              
              // Â∞ùËØïÂ§öÁßçÊñπÂºèÊü•ÊâæÁõÆÊ†áÂÖÉÁ¥†
              let targetSection = document.getElementById(navData[index].section);
              
              // Â¶ÇÊûúÁõ¥Êé•Êü•ÊâæÂ§±Ë¥•ÔºåÂ∞ùËØïÂÖ∂‰ªñÊñπÊ≥ï
              if (!targetSection) {
                console.log('Mobile: Direct ID lookup failed, trying alternative methods...');
                
                // ÊñπÊ≥ï1ÔºöÊü•ÊâæÂåÖÂê´ÁâπÂÆöÊñáÊú¨ÁöÑÊ†áÈ¢òÂÖÉÁ¥†
                const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
                console.log('Mobile: Found headings:', headings.length);
                
                for (let heading of headings) {
                  console.log('Mobile: Checking heading:', heading.textContent.trim(), 'ID:', heading.id);
                  if (heading.textContent.includes(navData[index].title) || heading.id === navData[index].section) {
                    targetSection = heading;
                    console.log('Mobile: Found target heading:', heading);
                    break;
                  }
                }
                
                // ÊñπÊ≥ï2ÔºöÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
                if (!targetSection) {
                  console.log('Mobile: Heading search failed, trying anchor search...');
                  const allAnchors = document.querySelectorAll('[id]');
                  console.log('Mobile: All elements with ID:', allAnchors.length);
                  
                  for (let anchor of allAnchors) {
                    console.log('Mobile: Anchor ID:', anchor.id, 'Tag:', anchor.tagName, 'Text:', anchor.textContent.substring(0, 50));
                    if (anchor.id === navData[index].section || anchor.id.includes(navData[index].section)) {
                      targetSection = anchor;
                      console.log('Mobile: Found target anchor:', anchor);
                      break;
                    }
                  }
                }
                
                // ÊñπÊ≥ï3ÔºöÊü•ÊâæÂåÖÂê´sectionÂêçÁß∞ÁöÑspanÊàñÂÖ∂‰ªñÂÖÉÁ¥†
                if (!targetSection) {
                  console.log('Mobile: Anchor search failed, trying span search...');
                  const spans = document.querySelectorAll('span[id]');
                  for (let span of spans) {
                    if (span.id === navData[index].section) {
                      targetSection = span;
                      console.log('Mobile: Found target span:', span);
                      break;
                    }
                  }
                }
              }
              
              console.log('Mobile: Final target element found:', targetSection);
              
              if (targetSection) {
                // Á°Æ‰øùÂÖÉÁ¥†ÂèØËßÅ
                targetSection.style.scrollMarginTop = '100px'; // ‰∏∫Âõ∫ÂÆöÂØºËà™Ê†èÁïôÂá∫Á©∫Èó¥
                targetSection.scrollIntoView({ behavior: 'smooth' });
                console.log('Mobile: Successfully scrolled to section:', navData[index].section);
              } else {
                console.log('Mobile: All search methods failed for section:', navData[index].section);
                // Â∞ùËØïÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
                const allAnchors = document.querySelectorAll('[id]');
                console.log('Mobile: All available anchors:', Array.from(allAnchors).map(el => ({id: el.id, tag: el.tagName, text: el.textContent.substring(0, 30)})));
                
                // Â¶ÇÊûúËøòÊòØÊâæ‰∏çÂà∞ÔºåÂ∞ùËØï‰ΩøÁî®ÊµèËßàÂô®ÈªòËÆ§ÁöÑÈîöÁÇπË∑≥ËΩ¨
                console.log('Mobile: Falling back to default anchor behavior');
                window.location.hash = navData[index].section;
              }
              
              console.log('=== Mobile End Debug ===');
            });
          }
        }
      });
    } else {
      // Â¶ÇÊûúÊ≤°ÊúâÁé∞ÊúâÂØºËà™È°πÔºåÂàôÂàõÂª∫Êñ∞ÁöÑ
      navData.forEach((item) => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        
        // ËÆæÁΩÆÈìæÊé•Â±ûÊÄß - ‰ΩøÁî®Áõ∏ÂØπÈîöÁÇπÈìæÊé•
        a.href = `#${item.section}`;
        a.textContent = item.title;
        a.className = 'nav-link-mobile';
        a.dataset.section = item.section;
        
        // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜÈîöÁÇπË∑≥ËΩ¨
        a.addEventListener('click', function(e) {
          e.preventDefault();
          
          console.log('=== Mobile Navigation Click Debug ===');
          console.log('Current URL:', window.location.href);
          console.log('Current pathname:', window.location.pathname);
          console.log('Mobile: Clicking on:', item.title, 'section:', item.section);
          
          // Â∞ùËØïÂ§öÁßçÊñπÂºèÊü•ÊâæÁõÆÊ†áÂÖÉÁ¥†
          let targetSection = document.getElementById(item.section);
          
          // Â¶ÇÊûúÁõ¥Êé•Êü•ÊâæÂ§±Ë¥•ÔºåÂ∞ùËØïÂÖ∂‰ªñÊñπÊ≥ï
          if (!targetSection) {
            console.log('Mobile: Direct ID lookup failed, trying alternative methods...');
            
            // ÊñπÊ≥ï1ÔºöÊü•ÊâæÂåÖÂê´ÁâπÂÆöÊñáÊú¨ÁöÑÊ†áÈ¢òÂÖÉÁ¥†
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            console.log('Mobile: Found headings:', headings.length);
            
            for (let heading of headings) {
              console.log('Mobile: Checking heading:', heading.textContent.trim(), 'ID:', heading.id);
              if (heading.textContent.includes(item.title) || heading.id === item.section) {
                targetSection = heading;
                console.log('Mobile: Found target heading:', heading);
                break;
              }
            }
            
            // ÊñπÊ≥ï2ÔºöÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
            if (!targetSection) {
              console.log('Mobile: Heading search failed, trying anchor search...');
              const allAnchors = document.querySelectorAll('[id]');
              console.log('Mobile: All elements with ID:', allAnchors.length);
              
              for (let anchor of allAnchors) {
                console.log('Mobile: Anchor ID:', anchor.id, 'Tag:', anchor.tagName, 'Text:', anchor.textContent.substring(0, 50));
                if (anchor.id === item.section || anchor.id.includes(item.section)) {
                  targetSection = anchor;
                  console.log('Mobile: Found target anchor:', anchor);
                  break;
                }
              }
            }
            
            // ÊñπÊ≥ï3ÔºöÊü•ÊâæÂåÖÂê´sectionÂêçÁß∞ÁöÑspanÊàñÂÖ∂‰ªñÂÖÉÁ¥†
            if (!targetSection) {
              console.log('Mobile: Anchor search failed, trying span search...');
              const spans = document.querySelectorAll('span[id]');
              for (let span of spans) {
                if (span.id === item.section) {
                  targetSection = span;
                  console.log('Mobile: Found target span:', span);
                  break;
                }
              }
            }
          }
          
          console.log('Mobile: Final target element found:', targetSection);
          
          if (targetSection) {
            // Á°Æ‰øùÂÖÉÁ¥†ÂèØËßÅ
            targetSection.style.scrollMarginTop = '100px'; // ‰∏∫Âõ∫ÂÆöÂØºËà™Ê†èÁïôÂá∫Á©∫Èó¥
            targetSection.scrollIntoView({ behavior: 'smooth' });
            console.log('Mobile: Successfully scrolled to section:', item.section);
          } else {
            console.log('Mobile: All search methods failed for section:', item.section);
            // Â∞ùËØïÊü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÈîöÁÇπ
            const allAnchors = document.querySelectorAll('[id]');
            console.log('Mobile: All available anchors:', Array.from(allAnchors).map(el => ({id: el.id, tag: el.tagName, text: el.textContent.substring(0, 30)})));
            
            // Â¶ÇÊûúËøòÊòØÊâæ‰∏çÂà∞ÔºåÂ∞ùËØï‰ΩøÁî®ÊµèËßàÂô®ÈªòËÆ§ÁöÑÈîöÁÇπË∑≥ËΩ¨
            console.log('Mobile: Falling back to default anchor behavior');
            window.location.hash = item.section;
          }
          
          console.log('=== Mobile End Debug ===');
        });
        
        li.appendChild(a);
        mobileNavContainer.appendChild(li);
      });
    }
  }
}

// Êõ¥Êñ∞ÂØºËà™ÈìæÊé•
function updateNavigationLinks() {
  generateNavigationLinks();
}

// È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁîüÊàêÂØºËà™ÈìæÊé•
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(() => {
    generateNavigationLinks();
  }, 100);
});

// Á°Æ‰øùÂú®È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩÂêéÂÜçÊ¨°Ê£ÄÊü•
window.addEventListener('load', function() {
  setTimeout(() => {
    generateNavigationLinks();
  }, 200);
});

// ËØ≠Ë®ÄÂàáÊç¢ÂêéÊõ¥Êñ∞ÂØºËà™ÈìæÊé•
document.addEventListener('languageChanged', function() {
  generateNavigationLinks();
});
</script>