<script src="assets/js/main.min.js"></script>
<script src="assets/js/language-switcher.js"></script>

<!-- 移动端导航修复脚本 -->
<script>
// 确保在main.min.js加载后应用我们的修复
document.addEventListener('DOMContentLoaded', function() {
  // 等待一段时间确保所有脚本都加载完成
  setTimeout(function() {
    // 如果存在updateNav函数，应用我们的修复
    if (typeof window.updateNav === 'function') {
      console.log('Applying mobile navigation fix...');
      
      // 检测是否为移动设备
      function isMobile() {
        return window.innerWidth <= 768;
      }
      
      // 保存原始的updateNav函数
      var originalUpdateNav = window.updateNav;
      
      // 重写updateNav函数
      window.updateNav = function() {
        // 移动端特殊处理
        if (isMobile()) {
          var $nav = $('#site-nav');
          var $btn = $('#site-nav button');
          var $hlinks = $('#site-nav .hidden-links');
          
          if ($btn.length && $hlinks.length) {
            // 移动端始终显示按钮，但根据内容决定是否显示折叠框
            if (!$btn.hasClass('hidden')) {
              $btn.removeClass('hidden');
            }
            
            // 检查是否需要显示折叠框
            var hasHiddenItems = $hlinks.children().length > 0;
            if (hasHiddenItems) {
              $hlinks.removeClass('hidden');
            } else {
              $hlinks.addClass('hidden');
            }
            
            console.log('Mobile navigation fix applied - hidden items:', hasHiddenItems);
            return;
          }
        }
        
        // 桌面端使用原始逻辑
        if (originalUpdateNav) {
          originalUpdateNav();
        }
      };
      
      // 立即调用一次修复后的函数
      window.updateNav();
      
      // 监听窗口大小变化
      $(window).on('resize', function() {
        setTimeout(function() {
          window.updateNav();
        }, 100);
      });
      
      // 监听方向变化
      $(window).on('orientationchange', function() {
        setTimeout(function() {
          window.updateNav();
        }, 100);
      });
      
      console.log('Mobile navigation fix successfully applied');
    } else {
      console.log('updateNav function not found, using plugin-based fix');
    }
  }, 200);
});
</script>

{% include analytics.html %}
{% include fetch_google_scholar_stats.html %}
